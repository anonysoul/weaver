<section class="panel">
  <div class="panel-head">
    <div>
      <p class="panel-kicker">Repository</p>
      <h3>仓库目录盘点</h3>
      <p class="panel-subtitle">按 Provider 拉取仓库清单，准备 Session 绑定。</p>
    </div>
  </div>
  <div class="panel-body">
    <div class="repo-grid" *ngIf="providers.length; else repoEmpty">
      <article class="repo-card" *ngFor="let provider of providers">
        <div class="repo-head">
          <div>
            <h4>{{ provider.name }}</h4>
            <p class="muted">{{ provider.baseUrl }}</p>
          </div>
          <span class="badge">仓库 {{ repos[provider.id]?.length || 0 }}</span>
        </div>
        <div class="repo-actions">
          <button
            class="ghost"
            type="button"
            (click)="loadRepos.emit(provider)"
            [disabled]="loadingRepos[provider.id]"
          >
            {{ loadingRepos[provider.id] ? '拉取中' : '拉取仓库' }}
          </button>
        </div>
        <div class="repo-list" *ngIf="repos[provider.id]?.length; else repoHint">
          <ul>
            <li *ngFor="let repo of repos[provider.id]">
              <span class="repo-name">{{ repo.pathWithNamespace }}</span>
              <span class="repo-branch">默认分支：{{ repo.defaultBranch || '未知' }}</span>
            </li>
          </ul>
        </div>
        <ng-template #repoHint>
          <p class="muted">尚未拉取仓库清单。</p>
        </ng-template>
      </article>
    </div>
    <ng-template #repoEmpty>
      <div class="empty">
        <p>先配置 Provider 连接，再管理仓库。</p>
      </div>
    </ng-template>
  </div>
</section>
